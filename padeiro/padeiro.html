<!DOCTYPE html>
<html>

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script>
        $.ajax({
            url: "http://localhost:8080/api/orders/opened",
            crossDomain: true,
            dataType: 'json',
            success: function (data) {
                loadCards(data);
                loadTable(data);
            },
            type: 'GET'
        });

        $.ajax({
            url: "http://localhost:8080/api/orders/numbers",
            crossDomain: true,
            dataType: 'json',
            success: function (data) {
                loadTotal(data)
            },
            type: 'GET'
        });

    </script>
</head>

<body>
    <div class="row">
        <div class="col s4" id="cards">


        </div>
        <div class="col s8">
            <div class="row">
                <div id="total">

                </div>

                <div class="row">
                    <div class="col s12">
                        <table class="striped">
                            <thead>
                                <tr>
                                    <th>#</th>
                                    <th>Itens</th>
                                    <th>Cliente</th>
                                </tr>
                            </thead>

                            <tbody id="tableBody">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!--JavaScript at end of body for optimized loading-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
</body>

</html>

<script>
    function loadCards(cards) {
        const mainCards = cards.slice(0, 3);
        const cardTemplate = `
            <div class="card">
                <div class="card-content">
                    <span class="card-title activator grey-text text-darken-4"><a class="btn waves-block"><b
                                style="font-size: 30px;">#<number></b></a></span>
                    <table style="font-size: 15px;">
                        <tbody>
                         <items>
                        </tbody>
                    </table>
                </div>
            </div>`;
        const itemsTemplate = `
                                <tr>
                                    <td><name></td>
                                    <td><quantity></td>
                                </tr>`;

        let newHtmlCards = "";

        mainCards.forEach(card => {
            let itemsTable = "";
            card.items.forEach(item => {
                itemsTable = `${itemsTable} ${itemsTemplate.replace("<name>", item.name).replace("<quantity>", item.quantity)}`;
            });
            newHtmlCards = `${newHtmlCards} ${cardTemplate.replace("<items>", itemsTable).replace("<number>", card.number)}`;
        });

        $("#cards").html(newHtmlCards);
    }

    function loadTable(lines) {
        const lastLines = lines.slice(3, lines.length);
        const tableTemplate = `<tr>
                                    <td>#<number></td>
                                    <td><items></td>
                                    <td><custumer></td>
                                </tr>`

        let bodyTable = "";
        const itemsTemplate = `
        <div class="chip">
            <name>: <quantity>
        </div>`

        lastLines.forEach(line => {
            let itemsBody= "";
            line.items.forEach(item=> {
                itemsBody = `${itemsBody} ${itemsTemplate.replace("<name>", item.name).replace("<quantity>", item.quantity)}`
            })
            bodyTable = `${bodyTable} ${tableTemplate.replace("<number>", line.number).replace("<custumer>", line.custumer).replace("<items>", itemsBody)}`
        });
        $("#tableBody").html(bodyTable);

    }

    function loadTotal(items) {
        const totalCardTemplate = `   <div class="col s4" style="font-size: 20px;">
                                        <div class="card-panel teal">
                                            <span class="white-text">
                                                <name>: <quantity>
                                            </span>
                                        </div>
                                    </div>`

        let body = "";

        items.forEach(item => {
            body = `${body} ${totalCardTemplate.replace("<name>", item.name).replace("<quantity>", item.quantity)}`
        });
        $("#total").html(body);

    }



</script>